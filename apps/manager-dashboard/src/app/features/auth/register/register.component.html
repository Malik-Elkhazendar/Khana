<div class="auth-layout">
  <a class="skip-link dashboard-skip-link" href="#main-content">{{
    'AUTH.ACCESSIBILITY.SKIP_TO_MAIN_CONTENT' | translate
  }}</a>

  <!-- Form Column (Left/Start) -->
  <main class="auth-form-column" id="main-content">
    <div class="auth-form-container">
      <div class="register-header auth-header">
        <h1 class="register-title auth-title">
          {{ 'AUTH.REGISTER.TITLE' | translate }}
        </h1>
        <p class="register-subtitle auth-subtitle">
          {{ 'AUTH.REGISTER.SUBTITLE' | translate }}
        </p>
        <p class="register-signin auth-text-muted">
          {{ 'AUTH.REGISTER.HAVE_ACCOUNT' | translate }}
          <a routerLink="/login" class="link auth-link">{{
            'AUTH.REGISTER.SIGNIN_LINK' | translate
          }}</a>
        </p>
      </div>

      <form
        [formGroup]="registerForm"
        (ngSubmit)="onSubmit()"
        class="register-form auth-form"
      >
        @if (authStore.error()) {
        <div
          class="alert-error auth-alert auth-alert--error"
          role="alert"
          aria-live="polite"
        >
          {{ authStore.error() }}
        </div>
        }

        <div class="form-group auth-field">
          <label for="email" class="form-label auth-label">
            {{ 'AUTH.REGISTER.EMAIL_LABEL' | translate }}
            <span
              class="required auth-required"
              [attr.aria-label]="
                'AUTH.ACCESSIBILITY.REQUIRED_FIELD' | translate
              "
              >*</span
            >
          </label>
          <input
            id="email"
            type="email"
            formControlName="email"
            class="form-input auth-input"
            [placeholder]="'AUTH.REGISTER.EMAIL_PLACEHOLDER' | translate"
            autocomplete="email"
            inputmode="email"
            [attr.aria-label]="'AUTH.REGISTER.EMAIL_LABEL' | translate"
            [attr.aria-invalid]="emailControl?.invalid && emailControl?.touched"
            [attr.aria-describedby]="
              emailControl?.invalid && emailControl?.touched
                ? 'email-error'
                : null
            "
          />
          @if (emailControl?.invalid && emailControl?.touched) {
          <div id="email-error" class="form-error auth-error" role="alert">
            @if (emailControl?.hasError('required')) {
            <span>{{ 'AUTH.VALIDATION.EMAIL_REQUIRED' | translate }}</span>
            } @if (emailControl?.hasError('email')) {
            <span>{{ 'AUTH.VALIDATION.EMAIL_INVALID' | translate }}</span>
            } @if (emailControl?.hasError('duplicate')) {
            <span>{{ 'AUTH.VALIDATION.EMAIL_DUPLICATE' | translate }}</span>
            }
          </div>
          }
        </div>

        <div class="form-group auth-field">
          <label for="name" class="form-label auth-label">
            {{ 'AUTH.REGISTER.NAME_LABEL' | translate }}
            <span
              class="required auth-required"
              [attr.aria-label]="
                'AUTH.ACCESSIBILITY.REQUIRED_FIELD' | translate
              "
              >*</span
            >
          </label>
          <input
            id="name"
            type="text"
            formControlName="name"
            class="form-input auth-input"
            [placeholder]="'AUTH.REGISTER.NAME_PLACEHOLDER' | translate"
            autocomplete="name"
            [attr.aria-label]="'AUTH.REGISTER.NAME_LABEL' | translate"
            [attr.aria-invalid]="nameControl?.invalid && nameControl?.touched"
            [attr.aria-describedby]="
              nameControl?.invalid && nameControl?.touched ? 'name-error' : null
            "
          />
          @if (nameControl?.invalid && nameControl?.touched) {
          <div id="name-error" class="form-error auth-error" role="alert">
            @if (nameControl?.hasError('required')) {
            <span>{{ 'AUTH.VALIDATION.NAME_REQUIRED' | translate }}</span>
            } @if (nameControl?.hasError('minlength')) {
            <span>{{ 'AUTH.VALIDATION.NAME_MINLENGTH' | translate }}</span>
            }
          </div>
          }
        </div>

        <div class="form-group auth-field">
          <label for="phone" class="form-label auth-label">{{
            'AUTH.REGISTER.PHONE_LABEL' | translate
          }}</label>
          <input
            id="phone"
            type="tel"
            formControlName="phone"
            class="form-input auth-input"
            [placeholder]="'AUTH.REGISTER.PHONE_PLACEHOLDER' | translate"
            autocomplete="tel"
            inputmode="tel"
            [attr.aria-label]="'AUTH.REGISTER.PHONE_LABEL' | translate"
            [attr.aria-invalid]="phoneControl?.invalid && phoneControl?.touched"
            [attr.aria-describedby]="
              phoneControl?.invalid && phoneControl?.touched
                ? 'phone-error'
                : null
            "
          />
          @if (phoneControl?.invalid && phoneControl?.touched) {
          <div id="phone-error" class="form-error auth-error" role="alert">
            <span>{{ 'AUTH.VALIDATION.PHONE_INVALID' | translate }}</span>
          </div>
          }
        </div>

        <div class="form-group auth-field">
          <label for="password" class="form-label auth-label">
            {{ 'AUTH.REGISTER.PASSWORD_LABEL' | translate }}
            <span
              class="required auth-required"
              [attr.aria-label]="
                'AUTH.ACCESSIBILITY.REQUIRED_FIELD' | translate
              "
              >*</span
            >
          </label>
          <input
            id="password"
            type="password"
            formControlName="password"
            class="form-input auth-input"
            [placeholder]="'AUTH.REGISTER.PASSWORD_PLACEHOLDER' | translate"
            autocomplete="new-password"
            [attr.aria-label]="'AUTH.REGISTER.PASSWORD_LABEL' | translate"
            (focus)="onPasswordFocus()"
            (blur)="onPasswordBlur()"
            [attr.aria-invalid]="
              passwordControl?.invalid && passwordControl?.touched
            "
            [attr.aria-describedby]="
              passwordControl?.invalid && passwordControl?.touched
                ? 'password-error'
                : null
            "
          />
          @if (passwordControl?.invalid && passwordControl?.touched) {
          <div id="password-error" class="form-error auth-error" role="alert">
            @if (passwordControl?.hasError('required')) {
            <span>{{ 'AUTH.VALIDATION.PASSWORD_REQUIRED' | translate }}</span>
            } @if (passwordControl?.hasError('minlength')) {
            <span>{{ 'AUTH.VALIDATION.PASSWORD_MINLENGTH' | translate }}</span>
            } @if ( passwordControl?.hasError('uppercase') ||
            passwordControl?.hasError('lowercase') ||
            passwordControl?.hasError('number') ) {
            <span>{{ 'AUTH.VALIDATION.PASSWORD_STRENGTH' | translate }}</span>
            }
          </div>
          }

          <khana-password-strength-indicator
            [visible]="showPasswordStrength()"
            [result]="passwordStrength()"
            [percent]="passwordStrengthPercent()"
            [message]="getPasswordStrengthMessage()"
          ></khana-password-strength-indicator>
        </div>

        <div class="form-group auth-field">
          <label for="confirmPassword" class="form-label auth-label">
            {{ 'AUTH.REGISTER.CONFIRM_PASSWORD_LABEL' | translate }}
            <span
              class="required auth-required"
              [attr.aria-label]="
                'AUTH.ACCESSIBILITY.REQUIRED_FIELD' | translate
              "
              >*</span
            >
          </label>
          <input
            id="confirmPassword"
            type="password"
            formControlName="confirmPassword"
            class="form-input auth-input"
            [placeholder]="
              'AUTH.REGISTER.CONFIRM_PASSWORD_PLACEHOLDER' | translate
            "
            autocomplete="new-password"
            [attr.aria-label]="
              'AUTH.REGISTER.CONFIRM_PASSWORD_LABEL' | translate
            "
            [attr.aria-invalid]="
              (confirmPasswordControl?.invalid &&
                confirmPasswordControl?.touched) ||
              passwordMismatch
            "
            [attr.aria-describedby]="
              (confirmPasswordControl?.invalid &&
                confirmPasswordControl?.touched) ||
              passwordMismatch
                ? 'confirm-password-error'
                : null
            "
          />
          @if ( (confirmPasswordControl?.invalid &&
          confirmPasswordControl?.touched) || passwordMismatch ) {
          <div
            id="confirm-password-error"
            class="form-error auth-error"
            role="alert"
          >
            @if (confirmPasswordControl?.hasError('required')) {
            <span>{{ 'AUTH.VALIDATION.CONFIRM_REQUIRED' | translate }}</span>
            } @if (passwordMismatch) {
            <span>{{ 'AUTH.VALIDATION.PASSWORD_MISMATCH' | translate }}</span>
            }
          </div>
          }
        </div>

        <div class="form-group auth-field">
          <label class="checkbox-label auth-checkbox">
            <input
              type="checkbox"
              formControlName="acceptTerms"
              class="checkbox-input"
              [attr.aria-label]="'AUTH.REGISTER.AGREE_TERMS_TEXT' | translate"
              [attr.aria-invalid]="
                termsControl?.invalid && termsControl?.touched
              "
              [attr.aria-describedby]="
                termsControl?.invalid && termsControl?.touched
                  ? 'terms-error'
                  : null
              "
            />
            <span>
              {{ 'AUTH.REGISTER.AGREE_TERMS_TEXT' | translate }}
              <a routerLink="/" class="link auth-link">{{
                'AUTH.REGISTER.TERMS_LINK' | translate
              }}</a>
            </span>
          </label>
          @if (termsControl?.invalid && termsControl?.touched) {
          <div id="terms-error" class="form-error auth-error" role="alert">
            <span>{{ 'AUTH.VALIDATION.TERMS_REQUIRED' | translate }}</span>
          </div>
          }
        </div>

        <div class="form-actions auth-actions">
          <button
            type="submit"
            class="btn-primary auth-btn-primary"
            [disabled]="authStore.isLoading()"
            [attr.aria-busy]="authStore.isLoading()"
          >
            @if (authStore.isLoading()) {
            <span class="btn-loading auth-btn-loading">
              <span class="spinner auth-spinner" aria-hidden="true"></span>
              <span>{{ 'AUTH.REGISTER.LOADING_BUTTON' | translate }}</span>
            </span>
            } @else {
            <span>{{ 'AUTH.REGISTER.SUBMIT_BUTTON' | translate }}</span>
            }
          </button>
          <button
            type="button"
            class="btn-secondary auth-btn-secondary"
            (click)="onCancel()"
          >
            {{ 'AUTH.REGISTER.CANCEL_BUTTON' | translate }}
          </button>
        </div>

        <div class="register-footer auth-footer">
          <p class="text-muted auth-text-muted">
            <a routerLink="/login" class="link auth-link">{{
              'AUTH.REGISTER.BACK_LOGIN_LINK' | translate
            }}</a>
            <span class="footer-separator">|</span>
            <a routerLink="/" class="link auth-link">{{
              'AUTH.REGISTER.BACK_HOME_LINK' | translate
            }}</a>
          </p>
        </div>
      </form>
    </div>
  </main>

  <!-- Visual Column (Right/End) -->
  <aside class="auth-visual-column" aria-hidden="true">
    <div class="visual-content">
      <div class="network-visual">
        <div class="n-node core"><div class="n-pulse"></div></div>
        <div class="n-node satellite s-top"></div>
        <div class="n-node satellite s-right"></div>
        <div class="n-node satellite s-left"></div>

        <svg class="n-lines" viewBox="0 0 200 200">
          <line x1="100" y1="100" x2="100" y2="40" class="n-line l-1" />
          <line x1="100" y1="100" x2="160" y2="130" class="n-line l-2" />
          <line x1="100" y1="100" x2="40" y2="130" class="n-line l-3" />
        </svg>
      </div>
      <div class="visual-copy">
        <h2>{{ 'AUTH.REGISTER.VISUAL_TITLE' | translate }}</h2>
        <p>{{ 'AUTH.REGISTER.VISUAL_TEXT' | translate }}</p>
      </div>
    </div>
  </aside>
</div>
