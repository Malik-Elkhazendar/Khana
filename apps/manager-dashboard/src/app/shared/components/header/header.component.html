<header class="app-header" role="banner">
  <div class="header-inner">
    <a
      class="brand"
      href="/bookings"
      aria-label="Khana home"
      (click)="navigate('/bookings', $event)"
    >
      Khana
    </a>

    <nav class="primary-nav" role="navigation" aria-label="Primary navigation">
      <ul class="nav-list">
        <li class="nav-item" *ngFor="let item of navItems">
          <a
            *ngIf="item.route; else navPlaceholder"
            class="nav-link"
            [attr.href]="item.route"
            (click)="navigate(item.route, $event)"
          >
            {{ item.label }}
          </a>
          <ng-template #navPlaceholder>
            <span class="nav-link nav-link--disabled" aria-disabled="true">
              {{ item.label }}
            </span>
          </ng-template>
        </li>
      </ul>
    </nav>

    <div class="header-actions">
      <button
        class="menu-toggle"
        type="button"
        aria-label="Toggle navigation"
        [attr.aria-expanded]="mobileMenuOpen()"
        [attr.aria-controls]="mobileMenuId"
        (click)="toggleMobileMenu()"
      >
        <span class="menu-icon" aria-hidden="true">
          <span class="menu-bar"></span>
          <span class="menu-bar"></span>
          <span class="menu-bar"></span>
        </span>
      </button>

      <div class="user-area" *ngIf="currentUser() as user; else guestUser">
        <button
          class="user-button"
          type="button"
          aria-label="Toggle user menu"
          aria-haspopup="menu"
          [attr.aria-expanded]="userMenuOpen()"
          [attr.aria-controls]="userMenuId"
          (click)="toggleUserMenu()"
        >
          <span class="user-avatar" aria-hidden="true">
            {{ user.name ? user.name.slice(0, 1) : '' }}
          </span>
          <span class="user-info">
            <span class="user-name">{{ user.name }}</span>
            <span class="user-role">{{ user.role }}</span>
          </span>
          <span class="user-caret" aria-hidden="true"></span>
        </button>

        <div
          class="user-menu"
          *ngIf="userMenuOpen()"
          role="menu"
          [attr.id]="userMenuId"
        >
          <button
            class="user-menu__item"
            type="button"
            role="menuitem"
            disabled
            aria-disabled="true"
          >
            Settings
          </button>
          <button
            class="user-menu__item"
            type="button"
            role="menuitem"
            (click)="logout()"
          >
            Logout
          </button>
        </div>
      </div>
      <ng-template #guestUser>
        <button
          class="user-button user-button--ghost"
          type="button"
          disabled
          aria-disabled="true"
        >
          Sign in
        </button>
      </ng-template>
    </div>
  </div>

  <div class="mobile-panel" *ngIf="mobileMenuOpen()" [attr.id]="mobileMenuId">
    <nav class="mobile-nav" role="navigation" aria-label="Primary navigation">
      <ul class="nav-list nav-list--mobile">
        <li class="nav-item" *ngFor="let item of navItems">
          <a
            *ngIf="item.route; else mobileNavPlaceholder"
            class="nav-link"
            [attr.href]="item.route"
            (click)="navigate(item.route, $event)"
          >
            {{ item.label }}
          </a>
          <ng-template #mobileNavPlaceholder>
            <span class="nav-link nav-link--disabled" aria-disabled="true">
              {{ item.label }}
            </span>
          </ng-template>
        </li>
      </ul>
    </nav>
  </div>
</header>
